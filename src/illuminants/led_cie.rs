

use nalgebra::{SMatrixSlice, };

use crate::models::CieXYZ;
use crate::SpectralDistribution;
use crate::observers::StandardObserver;
use crate::util::{WavelengthStep, Domain};

use super::Illuminant;


/**
	CIE Standard LED illuminants.
*/

#[derive(Debug)]
pub struct CieIllLed<'a>(
	Domain<<Self as SpectralDistribution>::StepType>,
	<Self as SpectralDistribution>::MatrixType
);

impl<'a> super::Illuminant for CieIllLed<'a> {}

impl<'a, C:StandardObserver> From<CieIllLed<'a>> for CieXYZ<C> {
    fn from(led: CieIllLed<'a>) -> Self {
		led.xyz()
    }
}

impl<'a> Default for  CieIllLed<'a> {
    fn default() -> Self {
		Self (
			Domain::new(380/5, 780/5, crate::util::NM5),
			<Self as SpectralDistribution>::MatrixType::from_slice(&CIE_LED_ILL_DATA)
		)
    }
}

impl<'a> SpectralDistribution for CieIllLed<'a> {
    type MatrixType = SMatrixSlice<'a, f64, N, M>;
    type StepType = WavelengthStep;

	fn len(&self) -> usize {
		M
	}

    fn spd(&self) -> (Domain<Self::StepType>, Self::MatrixType) {
		(
			self.0.clone(),
			self.1
		)
    }
	
	fn keys(&self) -> Option<Vec<String>> {
		Some(CIE_LED_ILL_KEYS.iter().map(|s| s.to_string()).collect())
	}
}


const N:usize = 81;
const M:usize = 9;

illuminant!(LED, N, M, "CIE L{}", Domain::new(380/5, 780/5, crate::util::NM5), CIE_LED_ILL_DATA);

static CIE_LED_ILL_KEYS: [&str;9] = [
    "LED-B1",
    "LED-B2",
    "LED-B3",
    "LED-B4",
    "LED-B5",
    "LED-BH1",
    "LED-RGB1",
    "LED-V1",
    "LED-V2",
];

static CIE_LED_ILL_DATA: [f64;N*M] = [ // 380-780-5nm
    0.00, 0.01, 0.01, 0.02, 0.04, 0.07, 0.15, 0.28, 0.53, 0.92, 1.54, 2.52, 4.16, 6.39, 7.89, 7.57, 6.25, 5.16, 4.37,
    3.84, 3.70, 3.88, 4.26, 4.79, 5.41, 6.05, 6.70, 7.34, 7.98, 8.64, 9.31, 10.02, 10.76, 11.53, 12.38, 13.28, 14.23,
    15.20, 16.20, 17.19, 18.14, 19.02, 19.78, 20.38, 20.80, 21.00, 20.97, 20.71, 20.23, 19.56, 18.76, 17.82, 16.78,
    15.66, 14.49, 13.31, 12.15, 11.02, 9.95, 8.93, 7.98, 7.10, 6.30, 5.57, 4.89, 4.26, 3.72, 3.25, 2.83, 2.47, 2.15,
    1.87, 1.63, 1.42, 1.25, 1.10, 0.97, 0.86, 0.76, 0.68, 0.61, 0.00, 0.00, 0.00, 0.01, 0.02, 0.05, 0.11, 0.24, 0.50,
    0.96, 1.71, 2.82, 4.71, 7.87, 10.56, 10.24, 7.94, 6.25, 5.23, 4.36, 4.00, 4.17, 4.59, 5.21, 5.96, 6.72, 7.44, 8.11,
    8.74, 9.39, 10.06, 10.75, 11.49, 12.25, 13.05, 13.86, 14.70, 15.50, 16.28, 17.00, 17.69, 18.31, 18.83, 19.24, 19.51,
    19.59, 19.48, 19.19, 18.72, 18.10, 17.34, 16.47, 15.51, 14.49, 13.42, 12.33, 11.26, 10.24, 9.25, 8.30, 7.42, 6.60,
    5.85, 5.17, 4.55, 3.99, 3.49, 3.04, 2.65, 2.31, 2.01, 1.75, 1.52, 1.32, 1.15, 1.00, 0.87, 0.76, 0.67, 0.59, 0.52,
    0.00, 0.00, 0.01, 0.02, 0.05, 0.11, 0.25, 0.56, 1.20, 2.37, 4.24, 7.17, 12.11, 17.70, 18.87, 14.58, 9.90, 7.53,
    6.02, 5.11, 5.17, 5.82, 6.77, 7.88, 8.94, 9.82, 10.52, 11.06, 11.51, 11.93, 12.37, 12.83, 13.31, 13.79, 14.26,
    14.68, 15.08, 15.42, 15.72, 15.97, 16.18, 16.37, 16.50, 16.55, 16.50, 16.32, 16.00, 15.54, 14.96, 14.27, 13.48,
    12.62, 11.71, 10.78, 9.85, 8.93, 8.04, 7.20, 6.42, 5.69, 5.02, 4.42, 3.88, 3.39, 2.95, 2.56, 2.22, 1.92, 1.65, 1.43,
    1.23, 1.06, 0.91, 0.78, 0.68, 0.58, 0.50, 0.43, 0.37, 0.32, 0.28, 0.00, 0.00, 0.00, 0.01, 0.03, 0.08, 0.21, 0.54,
    1.31, 2.75, 5.04, 8.31, 13.37, 20.61, 25.91, 24.12, 17.47, 11.90, 8.62, 6.34, 4.89, 4.25, 4.19, 4.70, 5.77, 7.27,
    8.94, 10.60, 12.11, 13.36, 14.30, 15.02, 15.54, 15.90, 16.15, 16.33, 16.42, 16.44, 16.36, 16.20, 15.98, 15.70,
    15.36, 14.93, 14.44, 13.86, 13.24, 12.57, 11.84, 11.12, 10.38, 9.65, 8.91, 8.19, 7.51, 6.86, 6.21, 5.60, 5.05, 4.54,
    4.05, 3.62, 3.23, 2.87, 2.53, 2.24, 1.99, 1.76, 1.55, 1.37, 1.21, 1.07, 0.95, 0.85, 0.75, 0.67, 0.61, 0.55, 0.50,
    0.45, 0.42, 0.00, 0.01, 0.01, 0.03, 0.07, 0.16, 0.35, 0.78, 1.67, 3.30, 5.94, 9.92, 16.15, 25.15, 32.34, 31.18,
    23.46, 16.39, 12.08, 9.08, 7.21, 6.48, 6.49, 7.05, 8.10, 9.45, 10.88, 12.22, 13.38, 14.29, 14.98, 15.48, 15.81,
    16.01, 16.10, 16.13, 16.10, 15.98, 15.77, 15.50, 15.15, 14.76, 14.31, 13.79, 13.22, 12.59, 11.91, 11.20, 10.47,
    9.73, 9.00, 8.27, 7.57, 6.90, 6.25, 5.65, 5.08, 4.55, 4.06, 3.61, 3.22, 2.86, 2.54, 2.26, 2.00, 1.75, 1.54, 1.36,
    1.20, 1.05, 0.93, 0.82, 0.72, 0.64, 0.56, 0.49, 0.44, 0.39, 0.35, 0.31, 0.27, 0.00, 0.01, 0.02, 0.04, 0.08, 0.17,
    0.41, 0.93, 1.84, 3.05, 4.29, 5.69, 7.06, 7.91, 7.74, 6.62, 5.13, 3.85, 2.94, 2.34, 1.99, 1.92, 2.19, 2.87, 4.03,
    5.64, 7.49, 9.25, 10.82, 12.11, 13.08, 13.66, 14.01, 14.19, 14.28, 14.27, 14.19, 14.03, 13.82, 13.59, 13.35, 13.20,
    13.19, 13.46, 14.31, 16.15, 19.49, 25.07, 33.87, 40.75, 35.59, 21.59, 11.11, 7.27, 5.58, 4.64, 3.98, 3.48, 3.07,
    2.73, 2.42, 2.15, 1.91, 1.70, 1.50, 1.33, 1.18, 1.05, 0.93, 0.83, 0.74, 0.65, 0.57, 0.51, 0.46, 0.41, 0.37, 0.34,
    0.30, 0.28, 0.25, 0.00, 0.00, 0.00, 0.01, 0.02, 0.05, 0.11, 0.24, 0.50, 0.94, 1.60, 2.43, 3.38, 4.59, 5.84, 5.56,
    4.00, 3.14, 2.80, 2.68, 3.03, 3.98, 5.53, 7.84, 10.96, 14.61, 18.01, 20.24, 20.57, 19.22, 16.93, 14.58, 12.61,
    11.09, 9.93, 9.11, 8.60, 8.31, 8.21, 8.24, 8.42, 8.74, 9.25, 10.00, 11.10, 12.74, 15.35, 19.43, 26.01, 36.47, 51.10,
    62.69, 52.07, 28.62, 15.50, 9.58, 6.54, 4.95, 4.01, 3.37, 2.89, 2.51, 2.18, 1.92, 1.67, 1.44, 1.25, 1.09, 0.93,
    0.82, 0.71, 0.61, 0.53, 0.45, 0.40, 0.35, 0.30, 0.27, 0.24, 0.21, 0.17, 0.01, 0.03, 0.14, 0.61, 2.62, 8.43, 16.51,
    17.90, 11.26, 5.94, 3.31, 2.25, 2.07, 2.29, 2.68, 3.15, 3.64, 4.18, 4.83, 5.57, 6.40, 7.27, 8.08, 8.73, 9.21, 9.54,
    9.75, 9.91, 10.06, 10.26, 10.51, 10.82, 11.17, 11.55, 11.92, 12.30, 12.68, 13.07, 13.52, 14.06, 14.70, 15.46, 16.38,
    17.39, 18.50, 19.51, 20.52, 21.52, 22.38, 23.07, 23.51, 23.71, 23.67, 23.35, 22.81, 22.01, 21.03, 19.91, 18.69,
    17.39, 16.05, 14.69, 13.36, 12.04, 10.80, 9.62, 8.54, 7.57, 6.68, 5.86, 5.12, 4.46, 3.88, 3.37, 2.94, 2.54, 2.21,
    1.90, 1.65, 1.44, 1.22, 0.01, 0.06, 0.26, 1.15, 4.47, 11.98, 19.89, 20.24, 14.39, 8.95, 5.78, 4.65, 4.86, 5.78,
    6.97, 8.10, 9.05, 9.82, 10.52, 11.21, 11.87, 12.50, 12.98, 13.23, 13.30, 13.21, 13.05, 12.88, 12.74, 12.68, 12.70,
    12.77, 12.91, 13.04, 13.16, 13.26, 13.35, 13.42, 13.52, 13.64, 13.83, 14.07, 14.42, 14.82, 15.26, 15.64, 16.03,
    16.40, 16.67, 16.88, 16.93, 16.85, 16.62, 16.23, 15.72, 15.07, 14.31, 13.45, 12.57, 11.64, 10.69, 9.78, 8.87, 8.00,
    7.17, 6.37, 5.65, 5.01, 4.42, 3.88, 3.39, 2.95, 2.58, 2.24, 1.95, 1.70, 1.47, 1.30, 1.10, 0.96, 0.84,
];


